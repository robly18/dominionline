<html>
<head>

<script>
function requestAction(c) {
	return JSON.stringify([playerno, {tag:"Request", contents:c}]);
}

function passAction() {
	return JSON.stringify([playerno, {tag:"Pass"}]);
}

function pollAction() {
	return JSON.stringify([playerno, {tag:"Poll"}]);
}

function startAction() {
	return JSON.stringify([playerno, {tag:"Start"}]);
}

function ajax(url, data, callback) {
  var xhttp;
  xhttp=new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      callback(this);
    }
  };
  xhttp.open("POST", url, true);
  xhttp.send(data);
}

function render(data) {
	//let state = JSON.parse(data.responseText);
	console.log(data.responseText);
}

let playerno = null;

function getPlayer(data) {
	playerno = JSON.parse(data.responseText);
}
</script>
</head>
<body>
<h1>Hello world.</h1>

<p id="log">No messages yet.</p>

<input type="text" id="box">

<p id=playerctr></p>

<br>

<button type="button"
id="send"
onclick="ajax('/send/', requestAction(parseInt(document.getElementById('box').value)), render)">Send
</button>

<br>

<button type="button"
id="join"
onclick="ajax('/join/', '', getPlayer)">Join
</button>

<br>

<button type="button"
id="start"
onclick="ajax('/send/', startAction(), render)">Start
</button>

<script>
ajax('/send/', pollAction(), render);
window.setInterval(function(){ajax('/send/', pollAction(), render)}, 3000)</script>
</body>
</html>